<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Speech Recognition Highlighting</title>
</head>
<body>
<div id="content">
    <p id="text">마이크 테스트 중입니다 가나다라 마바사 아자차카 타파하</p>
</div>
<button id="btn">Start Recognition</button>

<script src="https://cdn.jsdelivr.net/npm/mustache@4.2.0/mustache.min.js"></script>
<script>
    const btn = document.getElementById('btn');

    const highlight = (text, from, to) => {
        let replacement = highlightBackground(text.slice(from, to));
        return text.substring(0, from) + replacement + text.substring(to);
    }

    const highlightBackground = sample => `<span style="background-color: yellow;">${sample}</span>`;

    btn.addEventListener('click', () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.interimResults = true;

        let textElement = document.getElementById('text');
        let originalText = textElement.innerText;

        recognition.addEventListener('result', event => {
            const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');

            let lastCharIndex = originalText.indexOf(transcript);
            if (lastCharIndex !== -1) {
                textElement.innerHTML = highlight(originalText, lastCharIndex, lastCharIndex + transcript.length);
            }
        });

        recognition.addEventListener('end', recognition.start);  // 계속 인식

        recognition.start();
    });
</script>
</body>
</html>